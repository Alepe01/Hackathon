<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explorador de Hábitat Espacial - Primera Persona</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000;
            color: #fff;
            overflow: hidden;
            cursor: none;
        }
        
        #container {
            width: 100vw;
            height: 100vh;
        }
        
        .crosshair {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            pointer-events: none;
            z-index: 100;
        }
        
        .crosshair::before,
        .crosshair::after {
            content: '';
            position: absolute;
            background: rgba(0, 255, 136, 0.8);
        }
        
        .crosshair::before {
            width: 2px;
            height: 100%;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .crosshair::after {
            width: 100%;
            height: 2px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .hud {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 30px;
            border-radius: 10px;
            border: 2px solid #00ff88;
            display: flex;
            gap: 30px;
        }
        
        .hud-item {
            text-align: center;
        }
        
        .hud-label {
            font-size: 11px;
            color: #888;
            margin-bottom: 5px;
        }
        
        .hud-value {
            font-size: 18px;
            color: #00ff88;
            font-weight: bold;
        }
        
        .controls-info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #00a8e8;
            max-width: 250px;
        }
        
        .controls-info h3 {
            color: #00a8e8;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .controls-info p {
            font-size: 12px;
            margin-bottom: 5px;
            color: #ccc;
        }
        
        .controls-info .key {
            display: inline-block;
            background: rgba(0, 255, 136, 0.2);
            padding: 2px 6px;
            border-radius: 3px;
            color: #00ff88;
            font-weight: bold;
            font-size: 11px;
        }
        
        .stats {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #ffaa00;
        }
        
        .stats h3 {
            color: #ffaa00;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 12px;
            gap: 15px;
        }
        
        .stat-label {
            color: #888;
        }
        
        .stat-value {
            color: #00ff88;
            font-weight: bold;
        }
        
        .instruction {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 30px;
            border-radius: 15px;
            border: 3px solid #00ff88;
            text-align: center;
            z-index: 200;
        }
        
        .instruction h2 {
            color: #00ff88;
            margin-bottom: 15px;
        }
        
        .instruction p {
            margin-bottom: 20px;
            color: #ccc;
        }
        
        .instruction button {
            padding: 15px 30px;
            background: linear-gradient(135deg, #00ff88, #00cc70);
            border: none;
            border-radius: 8px;
            color: #000;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
        }
        
        .instruction button:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div id="container"></div>
    
    <div class="crosshair"></div>
    
    <div class="instruction" id="instruction">
        <h2>🚀 Bienvenido al Hábitat Espacial</h2>
        <p>Click en el botón para comenzar la exploración</p>
        <p style="font-size: 12px; color: #888;">Mueve el mouse para mirar alrededor</p>
        <button id="start-btn">Iniciar Exploración</button>
    </div>
    
    <div class="hud">
        <div class="hud-item">
            <div class="hud-label">VELOCIDAD</div>
            <div class="hud-value" id="speed">0.0 m/s</div>
        </div>
        <div class="hud-item">
            <div class="hud-label">ALTURA</div>
            <div class="hud-value" id="height">1.8 m</div>
        </div>
        <div class="hud-item">
            <div class="hud-label">OXÍGENO</div>
            <div class="hud-value" id="oxygen">100%</div>
        </div>
    </div>
    
    <div class="controls-info">
        <h3>⌨️ Controles</h3>
        <p><span class="key">W A S D</span> Mover</p>
        <p><span class="key">ESPACIO</span> Saltar</p>
        <p><span class="key">SHIFT</span> Correr</p>
        <p><span class="key">MOUSE</span> Mirar</p>
        <p><span class="key">ESC</span> Liberar cursor</p>
    </div>
    
    <div class="stats">
        <h3>📊 Sistema</h3>
        <div class="stat-row">
            <span class="stat-label">FPS:</span>
            <span class="stat-value" id="fps">60</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">Posición X:</span>
            <span class="stat-value" id="pos-x">0</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">Posición Z:</span>
            <span class="stat-value" id="pos-z">0</span>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer;
        let moveForward = false, moveBackward = false;
        let moveLeft = false, moveRight = false;
        let canJump = false;
        let isRunning = false;
        
        const velocity = new THREE.Vector3();
        const direction = new THREE.Vector3();
        let prevTime = performance.now();
        
        // Configuración del jugador
        const playerHeight = 1.8;
        const playerSpeed = 10.0;
        const runMultiplier = 2.0;
        const jumpVelocity = 8.0;
        const gravity = -15.0;
        
        // FPS
        let frameCount = 0;
        let lastTime = Date.now();
        let fps = 60;
        
        // Pointer Lock
        let controls = {
            isLocked: false
        };
        
        function init() {
            const container = document.getElementById('container');
            
            // Escena
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a2e);
            scene.fog = new THREE.Fog(0x1a1a2e, 0, 50);
            
            // Cámara (altura de ojos)
            camera = new THREE.PerspectiveCamera(
                75,
                window.innerWidth / window.innerHeight,
                0.1,
                1000
            );
            camera.position.y = playerHeight;
            
            // Renderizador
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild(renderer.domElement);
            
            // Luces
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
            scene.add(ambientLight);
            
            const sunLight = new THREE.DirectionalLight(0xffffee, 0.8);
            sunLight.position.set(10, 20, 5);
            sunLight.castShadow = true;
            sunLight.shadow.camera.left = -30;
            sunLight.shadow.camera.right = 30;
            sunLight.shadow.camera.top = 30;
            sunLight.shadow.camera.bottom = -30;
            sunLight.shadow.mapSize.width = 2048;
            sunLight.shadow.mapSize.height = 2048;
            scene.add(sunLight);
            
            // Luz de punto (iluminación interior)
            const pointLight = new THREE.PointLight(0x00ffff, 1, 50);
            pointLight.position.set(0, 5, 0);
            scene.add(pointLight);
            
            // Crear entorno
            createFloor();
            createHabitat();
            createFurniture();
            createEquipment();
            
            // Event listeners
            setupEventListeners();
            
            // Resize
            window.addEventListener('resize', onWindowResize);
            
            // Comenzar loop
            animate();
        }
        
        // Crear piso
        function createFloor() {
            const floorGeometry = new THREE.PlaneGeometry(40, 40);
            const floorMaterial = new THREE.MeshStandardMaterial({
                color: 0x333344,
                roughness: 0.8,
                metalness: 0.2
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            scene.add(floor);
            
            // Grid
            const gridHelper = new THREE.GridHelper(40, 40, 0x00ff88, 0x444444);
            scene.add(gridHelper);
        }
        
        // Crear hábitat (paredes y techo)
        function createHabitat() {
            const wallMaterial = new THREE.MeshStandardMaterial({
                color: 0x4a4a5a,
                roughness: 0.7,
                metalness: 0.3
            });
            
            // Paredes
            const wallThickness = 0.5;
            const wallHeight = 6;
            const habitatSize = 20;
            
            // Pared Norte
            const wallNorth = new THREE.Mesh(
                new THREE.BoxGeometry(habitatSize, wallHeight, wallThickness),
                wallMaterial
            );
            wallNorth.position.set(0, wallHeight/2, -habitatSize/2);
            wallNorth.castShadow = true;
            wallNorth.receiveShadow = true;
            scene.add(wallNorth);
            
            // Pared Sur
            const wallSouth = new THREE.Mesh(
                new THREE.BoxGeometry(habitatSize, wallHeight, wallThickness),
                wallMaterial
            );
            wallSouth.position.set(0, wallHeight/2, habitatSize/2);
            wallSouth.castShadow = true;
            wallSouth.receiveShadow = true;
            scene.add(wallSouth);
            
            // Pared Este
            const wallEast = new THREE.Mesh(
                new THREE.BoxGeometry(wallThickness, wallHeight, habitatSize),
                wallMaterial
            );
            wallEast.position.set(habitatSize/2, wallHeight/2, 0);
            wallEast.castShadow = true;
            wallEast.receiveShadow = true;
            scene.add(wallEast);
            
            // Pared Oeste
            const wallWest = new THREE.Mesh(
                new THREE.BoxGeometry(wallThickness, wallHeight, habitatSize),
                wallMaterial
            );
            wallWest.position.set(-habitatSize/2, wallHeight/2, 0);
            wallWest.castShadow = true;
            wallWest.receiveShadow = true;
            scene.add(wallWest);
            
            // Techo
            const ceiling = new THREE.Mesh(
                new THREE.PlaneGeometry(habitatSize, habitatSize),
                new THREE.MeshStandardMaterial({
                    color: 0x2a2a3a,
                    roughness: 0.9
                })
            );
            ceiling.rotation.x = Math.PI / 2;
            ceiling.position.y = wallHeight;
            ceiling.receiveShadow = true;
            scene.add(ceiling);
        }
        
        // Crear muebles (modelos 3D simples)
        function createFurniture() {
            // Mesa central
            const table = new THREE.Group();
            
            // Superficie de mesa
            const tableTop = new THREE.Mesh(
                new THREE.BoxGeometry(3, 0.1, 1.5),
                new THREE.MeshStandardMaterial({
                    color: 0x8b7355,
                    roughness: 0.6,
                    metalness: 0.1
                })
            );
            tableTop.position.y = 1;
            tableTop.castShadow = true;
            tableTop.receiveShadow = true;
            table.add(tableTop);
            
            // Patas de mesa
            const legGeometry = new THREE.CylinderGeometry(0.05, 0.05, 1, 8);
            const legMaterial = new THREE.MeshStandardMaterial({
                color: 0x555555,
                metalness: 0.8,
                roughness: 0.3
            });
            
            const positions = [
                [-1.3, 0.5, -0.6],
                [1.3, 0.5, -0.6],
                [-1.3, 0.5, 0.6],
                [1.3, 0.5, 0.6]
            ];
            
            positions.forEach(pos => {
                const leg = new THREE.Mesh(legGeometry, legMaterial);
                leg.position.set(...pos);
                leg.castShadow = true;
                table.add(leg);
            });
            
            table.position.set(0, 0, 0);
            scene.add(table);
            
            // Sillas
            createChair(-2, 0, 2);
            createChair(2, 0, 2);
            createChair(-2, 0, -2);
            createChair(2, 0, -2);
        }
        
        // Crear silla
        function createChair(x, y, z) {
            const chair = new THREE.Group();
            
            const chairMaterial = new THREE.MeshStandardMaterial({
                color: 0x2a5a8a,
                roughness: 0.5,
                metalness: 0.3
            });
            
            // Asiento
            const seat = new THREE.Mesh(
                new THREE.BoxGeometry(0.6, 0.1, 0.6),
                chairMaterial
            );
            seat.position.y = 0.6;
            seat.castShadow = true;
            seat.receiveShadow = true;
            chair.add(seat);
            
            // Respaldo
            const back = new THREE.Mesh(
                new THREE.BoxGeometry(0.6, 0.8, 0.1),
                chairMaterial
            );
            back.position.set(0, 1, -0.25);
            back.castShadow = true;
            chair.add(back);
            
            // Patas
            const legGeometry = new THREE.CylinderGeometry(0.03, 0.03, 0.6, 8);
            const legMaterial = new THREE.MeshStandardMaterial({
                color: 0x333333,
                metalness: 0.7
            });
            
            [[-0.25, 0.3, -0.25], [0.25, 0.3, -0.25],
             [-0.25, 0.3, 0.25], [0.25, 0.3, 0.25]].forEach(pos => {
                const leg = new THREE.Mesh(legGeometry, legMaterial);
                leg.position.set(...pos);
                leg.castShadow = true;
                chair.add(leg);
            });
            
            chair.position.set(x, y, z);
            scene.add(chair);
        }
        
        // Crear equipamiento
        function createEquipment() {
            // Computadora en la mesa
            const computer = new THREE.Mesh(
                new THREE.BoxGeometry(0.4, 0.3, 0.02),
                new THREE.MeshStandardMaterial({
                    color: 0x1a1a1a,
                    emissive: 0x00ffff,
                    emissiveIntensity: 0.3
                })
            );
            computer.position.set(0, 1.2, 0);
            computer.castShadow = true;
            scene.add(computer);
            
            // Cajas de almacenamiento
            for (let i = 0; i < 5; i++) {
                const box = new THREE.Mesh(
                    new THREE.BoxGeometry(0.8, 0.8, 0.8),
                    new THREE.MeshStandardMaterial({
                        color: Math.random() * 0xffffff,
                        roughness: 0.6,
                        metalness: 0.4
                    })
                );
                box.position.set(
                    -8 + Math.random() * 2,
                    0.4,
                    -8 + i * 2
                );
                box.castShadow = true;
                box.receiveShadow = true;
                scene.add(box);
            }
            
            // Cilindro de oxígeno
            const oxygenTank = new THREE.Mesh(
                new THREE.CylinderGeometry(0.3, 0.3, 1.5, 16),
                new THREE.MeshStandardMaterial({
                    color: 0x00ff00,
                    metalness: 0.9,
                    roughness: 0.1
                })
            );
            oxygenTank.position.set(8, 0.75, 8);
            oxygenTank.castShadow = true;
            scene.add(oxygenTank);
        }
        
        // Event listeners
        function setupEventListeners() {
            // Botón de inicio
            document.getElementById('start-btn').addEventListener('click', () => {
                document.getElementById('instruction').style.display = 'none';
                renderer.domElement.requestPointerLock();
            });
            
            // Pointer Lock
            document.addEventListener('pointerlockchange', () => {
                controls.isLocked = document.pointerLockElement === renderer.domElement;
            });
            
            // Teclado
            document.addEventListener('keydown', (e) => {
                switch(e.code) {
                    case 'KeyW': moveForward = true; break;
                    case 'KeyS': moveBackward = true; break;
                    case 'KeyA': moveLeft = true; break;
                    case 'KeyD': moveRight = true; break;
                    case 'Space':
                        if (canJump) {
                            velocity.y = jumpVelocity;
                            canJump = false;
                        }
                        break;
                    case 'ShiftLeft':
                    case 'ShiftRight':
                        isRunning = true;
                        break;
                }
            });
            
            document.addEventListener('keyup', (e) => {
                switch(e.code) {
                    case 'KeyW': moveForward = false; break;
                    case 'KeyS': moveBackward = false; break;
                    case 'KeyA': moveLeft = false; break;
                    case 'KeyD': moveRight = false; break;
                    case 'ShiftLeft':
                    case 'ShiftRight':
                        isRunning = false;
                        break;
                }
            });
            
            // Mouse
            document.addEventListener('mousemove', (e) => {
                if (!controls.isLocked) return;
                
                const movementX = e.movementX || 0;
                const movementY = e.movementY || 0;
                
                camera.rotation.y -= movementX * 0.002;
                camera.rotation.x -= movementY * 0.002;
                
                // Limitar rotación vertical
                camera.rotation.x = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, camera.rotation.x));
            });
        }
        
        // Actualizar HUD
        function updateHUD() {
            const speed = Math.sqrt(velocity.x * velocity.x + velocity.z * velocity.z);
            document.getElementById('speed').textContent = speed.toFixed(1) + ' m/s';
            document.getElementById('height').textContent = camera.position.y.toFixed(1) + ' m';
            document.getElementById('pos-x').textContent = camera.position.x.toFixed(1);
            document.getElementById('pos-z').textContent = camera.position.z.toFixed(1);
            document.getElementById('fps').textContent = Math.round(fps);
        }
        
        // Calcular FPS
        function calculateFPS() {
            frameCount++;
            const currentTime = Date.now();
            if (currentTime - lastTime >= 1000) {
                fps = frameCount;
                frameCount = 0;
                lastTime = currentTime;
            }
        }
        
        // Resize
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        // Loop de animación
        function animate() {
            requestAnimationFrame(animate);
            
            if (controls.isLocked) {
                const time = performance.now();
                const delta = (time - prevTime) / 1000;
                
                // Aplicar gravedad
                velocity.y += gravity * delta;
                
                // Dirección de movimiento
                direction.z = Number(moveForward) - Number(moveBackward);
                direction.x = Number(moveRight) - Number(moveLeft);
                direction.normalize();
                
                // Velocidad con o sin correr
                const currentSpeed = isRunning ? playerSpeed * runMultiplier : playerSpeed;
                
                if (moveForward || moveBackward) {
                    velocity.z = -direction.z * currentSpeed;
                } else {
                    velocity.z *= 0.9; // Fricción
                }
                
                if (moveLeft || moveRight) {
                    velocity.x = -direction.x * currentSpeed;
                } else {
                    velocity.x *= 0.9; // Fricción
                }
                
                // Mover cámara
                const forward = new THREE.Vector3(0, 0, -1);
                forward.applyQuaternion(camera.quaternion);
                forward.y = 0;
                forward.normalize();
                
                const right = new THREE.Vector3(1, 0, 0);
                right.applyQuaternion(camera.quaternion);
                right.y = 0;
                right.normalize();
                
                camera.position.addScaledVector(forward, velocity.z * delta);
                camera.position.addScaledVector(right, velocity.x * delta);
                camera.position.y += velocity.y * delta;
                
                // Colisión con el suelo
                if (camera.position.y < playerHeight) {
                    camera.position.y = playerHeight;
                    velocity.y = 0;
                    canJump = true;
                }
                
                // Límites del hábitat
                const limit = 9.5;
                camera.position.x = Math.max(-limit, Math.min(limit, camera.position.x));
                camera.position.z = Math.max(-limit, Math.min(limit, camera.position.z));
                
                prevTime = time;
            }
            
            updateHUD();
            calculateFPS();
            renderer.render(scene, camera);
        }
        
        // Iniciar
        init();
    </script>
</body>
</html>