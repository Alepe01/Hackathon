<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dise√±ador de H√°bitats Espaciales - NASA</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1a2e 50%, #0f0f1e 100%);
            color: #fff;
            min-height: 100vh;
        }
        
        .container {
            display: grid;
            grid-template-columns: 350px 1fr;
            height: 100vh;
        }
        
        /* Panel de controles */
        .controls-panel {
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            overflow-y: auto;
            border-right: 2px solid #00a8e8;
        }
        
        header {
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 24px;
            color: #00a8e8;
            margin-bottom: 5px;
        }
        
        .subtitle {
            font-size: 12px;
            color: #888;
        }
        
        .section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid rgba(0, 168, 232, 0.3);
        }
        
        .section h2 {
            font-size: 16px;
            color: #00a8e8;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .section h2::before {
            content: "‚ñ∂";
            font-size: 12px;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            font-size: 13px;
            margin-bottom: 5px;
            color: #ccc;
        }
        
        select, input[type="number"], input[type="range"] {
            width: 100%;
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(0, 168, 232, 0.5);
            border-radius: 5px;
            color: #fff;
            font-size: 14px;
        }
        
        input[type="range"] {
            padding: 0;
        }
        
        .value-display {
            float: right;
            color: #00ff88;
            font-weight: bold;
        }
        
        button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #00a8e8, #0077b6);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 168, 232, 0.4);
        }
        
        .areas-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
        
        .area-item {
            background: rgba(0, 168, 232, 0.2);
            padding: 8px;
            border-radius: 5px;
            margin-bottom: 5px;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .area-item.warning {
            background: rgba(255, 165, 0, 0.3);
            border-left: 3px solid orange;
        }
        
        .area-item.valid {
            background: rgba(0, 255, 136, 0.2);
            border-left: 3px solid #00ff88;
        }
        
        .remove-btn {
            background: #ff4444;
            border: none;
            color: white;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
        }
        
        /* Visor 3D */
        .viewer {
            position: relative;
            background: #000;
        }
        
        #canvas-container {
            width: 100%;
            height: 100%;
        }
        
        .stats-overlay {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #00a8e8;
            min-width: 200px;
        }
        
        .stats-overlay h3 {
            color: #00a8e8;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 12px;
        }
        
        .stat-label {
            color: #888;
        }
        
        .stat-value {
            color: #00ff88;
            font-weight: bold;
        }
        
        .warning-text {
            color: orange;
        }
        
        .valid-text {
            color: #00ff88;
        }
        
        /* Scrollbar personalizado */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        
        ::-webkit-scrollbar-thumb {
            background: #00a8e8;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Panel de controles -->
        <div class="controls-panel">
            <header>
                <h1>üöÄ Dise√±ador de H√°bitats Espaciales</h1>
                <p class="subtitle">NASA Artemis Mission Planning Tool</p>
            </header>
            
            <!-- Configuraci√≥n de Misi√≥n -->
            <div class="section">
                <h2>Configuraci√≥n de Misi√≥n</h2>
                
                <div class="input-group">
                    <label>Destino:</label>
                    <select id="destination">
                        <option value="moon">Luna (Moon)</option>
                        <option value="mars">Marte (Mars)</option>
                        <option value="transit">En Tr√°nsito</option>
                        <option value="orbit">√ìrbita Terrestre</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label>N√∫mero de Tripulantes: <span class="value-display" id="crew-display">4</span></label>
                    <input type="range" id="crew-size" min="1" max="12" value="4">
                </div>
                
                <div class="input-group">
                    <label>Duraci√≥n Misi√≥n (d√≠as): <span class="value-display" id="duration-display">30</span></label>
                    <input type="range" id="mission-duration" min="7" max="365" value="30">
                </div>
            </div>
            
            <!-- Configuraci√≥n de Estructura -->
            <div class="section">
                <h2>Estructura del H√°bitat</h2>
                
                <div class="input-group">
                    <label>Tipo de H√°bitat:</label>
                    <select id="habitat-type">
                        <option value="metallic">Met√°lico (R√≠gido)</option>
                        <option value="inflatable">Inflable</option>
                        <option value="surface">Manufactura en Superficie</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label>Forma:</label>
                    <select id="habitat-shape">
                        <option value="cylinder">Cilindro</option>
                        <option value="sphere">Esfera</option>
                        <option value="torus">Toroide</option>
                        <option value="box">Rectangular</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label>Di√°metro (m): <span class="value-display" id="diameter-display">8</span></label>
                    <input type="range" id="diameter" min="3" max="15" step="0.5" value="8">
                </div>
                
                <div class="input-group">
                    <label>Altura/Longitud (m): <span class="value-display" id="height-display">10</span></label>
                    <input type="range" id="height" min="3" max="20" step="0.5" value="10">
                </div>
                
                <div class="input-group">
                    <label>Niveles: <span class="value-display" id="levels-display">2</span></label>
                    <input type="range" id="levels" min="1" max="4" value="2">
                </div>
                
                <button id="generate-habitat">Generar H√°bitat</button>
            </div>
            
            <!-- √Åreas Funcionales -->
            <div class="section">
                <h2>√Åreas Funcionales</h2>
                
                <div class="input-group">
                    <label>Seleccionar √Årea:</label>
                    <select id="area-type">
                        <option value="sleep">Dormitorios</option>
                        <option value="hygiene">Higiene</option>
                        <option value="food">Comida y Cocina</option>
                        <option value="exercise">Ejercicio</option>
                        <option value="medical">M√©dica</option>
                        <option value="work">Estaci√≥n de Trabajo</option>
                        <option value="storage">Almacenamiento</option>
                        <option value="life-support">Soporte Vital</option>
                        <option value="recreation">Recreaci√≥n</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label>√Årea (m¬≤): <span class="value-display" id="area-size-display">10</span></label>
                    <input type="range" id="area-size" min="2" max="30" step="1" value="10">
                </div>
                
                <button id="add-area">Agregar √Årea</button>
                
                <div class="areas-list" id="areas-list"></div>
            </div>
            
            <div class="section">
                <h2>Acciones</h2>
                <button id="clear-all">Limpiar Todo</button>
                <button id="export-design" style="background: linear-gradient(135deg, #00ff88, #00cc70);">Exportar Dise√±o</button>
            </div>
        </div>
        
        <!-- Visor 3D -->
        <div class="viewer">
            <div id="canvas-container"></div>
            
            <div class="stats-overlay">
                <h3>üìä Estad√≠sticas</h3>
                <div class="stat-row">
                    <span class="stat-label">Volumen Total:</span>
                    <span class="stat-value" id="total-volume">0 m¬≥</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">√Årea de Piso:</span>
                    <span class="stat-value" id="floor-area">0 m¬≤</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">√Årea Asignada:</span>
                    <span class="stat-value" id="assigned-area">0 m¬≤</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">√Årea Libre:</span>
                    <span class="stat-value" id="free-area">0 m¬≤</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Uso del Espacio:</span>
                    <span class="stat-value" id="space-usage">0%</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Estado:</span>
                    <span class="stat-value valid-text" id="design-status">‚úì V√°lido</span>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Variables globales
        let scene, camera, renderer;
        let habitat, habitatGroup;
        let areas = [];
        
        // Datos de la misi√≥n
        let missionData = {
            destination: 'moon',
            crewSize: 4,
            duration: 30,
            habitatType: 'metallic',
            shape: 'cylinder',
            diameter: 8,
            height: 10,
            levels: 2
        };
        
        // Requisitos m√≠nimos por √°rea (m¬≤ por persona)
        const areaRequirements = {
            sleep: 4,
            hygiene: 2,
            food: 3,
            exercise: 5,
            medical: 4,
            work: 3,
            storage: 2,
            'life-support': 3,
            recreation: 4
        };
        
        // Nombres en espa√±ol
        const areaNames = {
            sleep: 'Dormitorios',
            hygiene: 'Higiene',
            food: 'Comida',
            exercise: 'Ejercicio',
            medical: 'M√©dica',
            work: 'Trabajo',
            storage: 'Almacenamiento',
            'life-support': 'Soporte Vital',
            recreation: 'Recreaci√≥n'
        };
        
        // Inicializar escena
        function init() {
            const container = document.getElementById('canvas-container');
            
            // Escena
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000000);
            
            // C√°mara
            camera = new THREE.PerspectiveCamera(
                60,
                container.clientWidth / container.clientHeight,
                0.1,
                1000
            );
            camera.position.set(15, 15, 15);
            camera.lookAt(0, 0, 0);
            
            // Renderizador
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);
            
            // Luces
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 10, 10);
            scene.add(directionalLight);
            
            const directionalLight2 = new THREE.DirectionalLight(0x4488ff, 0.4);
            directionalLight2.position.set(-10, -10, -10);
            scene.add(directionalLight2);
            
            // Grid
            const gridHelper = new THREE.GridHelper(50, 50, 0x00a8e8, 0x444444);
            scene.add(gridHelper);
            
            // Grupo para el h√°bitat
            habitatGroup = new THREE.Group();
            scene.add(habitatGroup);
            
            // Generar h√°bitat inicial
            generateHabitat();
            
            // Event listeners
            setupEventListeners();
            
            // Resize handler
            window.addEventListener('resize', onWindowResize);
            
            // Controles de c√°mara con mouse
            let isDragging = false;
            let previousMousePosition = { x: 0, y: 0 };
            
            renderer.domElement.addEventListener('mousedown', (e) => {
                isDragging = true;
            });
            
            renderer.domElement.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    const deltaX = e.offsetX - previousMousePosition.x;
                    const deltaY = e.offsetY - previousMousePosition.y;
                    
                    const rotationSpeed = 0.005;
                    
                    const newX = camera.position.x * Math.cos(deltaX * rotationSpeed) - camera.position.z * Math.sin(deltaX * rotationSpeed);
                    const newZ = camera.position.x * Math.sin(deltaX * rotationSpeed) + camera.position.z * Math.cos(deltaX * rotationSpeed);
                    
                    camera.position.x = newX;
                    camera.position.z = newZ;
                    camera.lookAt(0, 0, 0);
                }
                
                previousMousePosition = { x: e.offsetX, y: e.offsetY };
            });
            
            renderer.domElement.addEventListener('mouseup', () => {
                isDragging = false;
            });
            
            // Zoom con rueda del mouse
            renderer.domElement.addEventListener('wheel', (e) => {
                e.preventDefault();
                const zoomSpeed = 0.1;
                const distance = camera.position.length();
                const newDistance = distance + (e.deltaY > 0 ? zoomSpeed : -zoomSpeed);
                
                if (newDistance > 5 && newDistance < 50) {
                    camera.position.multiplyScalar(newDistance / distance);
                }
            });
            
            // Animar
            animate();
        }
        
        // Generar h√°bitat
        function generateHabitat() {
            // Limpiar h√°bitat anterior
            while(habitatGroup.children.length > 0) {
                habitatGroup.remove(habitatGroup.children[0]);
            }
            
            let geometry;
            const material = new THREE.MeshStandardMaterial({
                color: 0x00a8e8,
                transparent: true,
                opacity: 0.3,
                side: THREE.DoubleSide,
                wireframe: false
            });
            
            const wireframeMaterial = new THREE.MeshBasicMaterial({
                color: 0x00ffff,
                wireframe: true,
                transparent: true,
                opacity: 0.8
            });
            
            const radius = missionData.diameter / 2;
            const height = missionData.height;
            
            // Crear geometr√≠a seg√∫n la forma
            switch(missionData.shape) {
                case 'cylinder':
                    geometry = new THREE.CylinderGeometry(radius, radius, height, 32);
                    break;
                case 'sphere':
                    geometry = new THREE.SphereGeometry(radius, 32, 32);
                    break;
                case 'torus':
                    geometry = new THREE.TorusGeometry(radius, radius/3, 16, 32);
                    break;
                case 'box':
                    geometry = new THREE.BoxGeometry(missionData.diameter, height, missionData.diameter);
                    break;
            }
            
            habitat = new THREE.Mesh(geometry, material);
            const wireframe = new THREE.Mesh(geometry, wireframeMaterial);
            
            habitatGroup.add(habitat);
            habitatGroup.add(wireframe);
            
            // Agregar niveles
            for(let i = 0; i < missionData.levels; i++) {
                const levelY = (i / (missionData.levels - 1) - 0.5) * height;
                const levelGeometry = new THREE.CircleGeometry(radius * 0.95, 32);
                const levelMaterial = new THREE.MeshBasicMaterial({
                    color: 0x444444,
                    side: THREE.DoubleSide,
                    transparent: true,
                    opacity: 0.2
                });
                const level = new THREE.Mesh(levelGeometry, levelMaterial);
                level.rotation.x = Math.PI / 2;
                level.position.y = levelY;
                habitatGroup.add(level);
            }
            
            updateStats();
        }
        
        // Configurar event listeners
        function setupEventListeners() {
            // Controles de sliders
            document.getElementById('crew-size').addEventListener('input', (e) => {
                missionData.crewSize = parseInt(e.target.value);
                document.getElementById('crew-display').textContent = missionData.crewSize;
                updateStats();
            });
            
            document.getElementById('mission-duration').addEventListener('input', (e) => {
                missionData.duration = parseInt(e.target.value);
                document.getElementById('duration-display').textContent = missionData.duration;
            });
            
            document.getElementById('diameter').addEventListener('input', (e) => {
                missionData.diameter = parseFloat(e.target.value);
                document.getElementById('diameter-display').textContent = missionData.diameter;
            });
            
            document.getElementById('height').addEventListener('input', (e) => {
                missionData.height = parseFloat(e.target.value);
                document.getElementById('height-display').textContent = missionData.height;
            });
            
            document.getElementById('levels').addEventListener('input', (e) => {
                missionData.levels = parseInt(e.target.value);
                document.getElementById('levels-display').textContent = missionData.levels;
            });
            
            document.getElementById('area-size').addEventListener('input', (e) => {
                document.getElementById('area-size-display').textContent = e.target.value;
            });
            
            // Selectores
            document.getElementById('destination').addEventListener('change', (e) => {
                missionData.destination = e.target.value;
            });
            
            document.getElementById('habitat-type').addEventListener('change', (e) => {
                missionData.habitatType = e.target.value;
            });
            
            document.getElementById('habitat-shape').addEventListener('change', (e) => {
                missionData.shape = e.target.value;
            });
            
            // Botones
            document.getElementById('generate-habitat').addEventListener('click', generateHabitat);
            
            document.getElementById('add-area').addEventListener('click', addArea);
            
            document.getElementById('clear-all').addEventListener('click', () => {
                areas = [];
                updateAreasList();
                updateStats();
            });
            
            document.getElementById('export-design').addEventListener('click', exportDesign);
        }
        
        // Agregar √°rea funcional
        function addArea() {
            const areaType = document.getElementById('area-type').value;
            const areaSize = parseFloat(document.getElementById('area-size').value);
            
            const minRequired = areaRequirements[areaType] * missionData.crewSize;
            const isValid = areaSize >= minRequired;
            
            areas.push({
                type: areaType,
                name: areaNames[areaType],
                size: areaSize,
                minRequired: minRequired,
                isValid: isValid
            });
            
            updateAreasList();
            updateStats();
        }
        
        // Actualizar lista de √°reas
        function updateAreasList() {
            const list = document.getElementById('areas-list');
            list.innerHTML = '';
            
            areas.forEach((area, index) => {
                const div = document.createElement('div');
                div.className = `area-item ${area.isValid ? 'valid' : 'warning'}`;
                div.innerHTML = `
                    <div>
                        <strong>${area.name}</strong><br>
                        ${area.size} m¬≤ ${area.isValid ? '‚úì' : `‚ö† (m√≠n: ${area.minRequired.toFixed(1)} m¬≤)`}
                    </div>
                    <button class="remove-btn" onclick="removeArea(${index})">‚úï</button>
                `;
                list.appendChild(div);
            });
        }
        
        // Remover √°rea
        function removeArea(index) {
            areas.splice(index, 1);
            updateAreasList();
            updateStats();
        }
        
        // Actualizar estad√≠sticas
        function updateStats() {
            const radius = missionData.diameter / 2;
            const height = missionData.height;
            
            let totalVolume, floorArea;
            
            switch(missionData.shape) {
                case 'cylinder':
                    totalVolume = Math.PI * radius * radius * height;
                    floorArea = Math.PI * radius * radius * missionData.levels;
                    break;
                case 'sphere':
                    totalVolume = (4/3) * Math.PI * Math.pow(radius, 3);
                    floorArea = Math.PI * radius * radius * missionData.levels;
                    break;
                case 'torus':
                    const R = radius;
                    const r = radius / 3;
                    totalVolume = 2 * Math.PI * Math.PI * R * r * r;
                    floorArea = 2 * Math.PI * R * missionData.levels;
                    break;
                case 'box':
                    totalVolume = missionData.diameter * height * missionData.diameter;
                    floorArea = missionData.diameter * missionData.diameter * missionData.levels;
                    break;
            }
            
            const assignedArea = areas.reduce((sum, area) => sum + area.size, 0);
            const freeArea = floorArea - assignedArea;
            const usage = (assignedArea / floorArea * 100).toFixed(1);
            
            const allValid = areas.every(area => area.isValid) && assignedArea <= floorArea;
            
            document.getElementById('total-volume').textContent = totalVolume.toFixed(1) + ' m¬≥';
            document.getElementById('floor-area').textContent = floorArea.toFixed(1) + ' m¬≤';
            document.getElementById('assigned-area').textContent = assignedArea.toFixed(1) + ' m¬≤';
            document.getElementById('free-area').textContent = freeArea.toFixed(1) + ' m¬≤';
            document.getElementById('space-usage').textContent = usage + '%';
            
            const statusElement = document.getElementById('design-status');
            if (allValid && freeArea >= 0) {
                statusElement.textContent = '‚úì V√°lido';
                statusElement.className = 'stat-value valid-text';
            } else {
                statusElement.textContent = '‚ö† Revisar';
                statusElement.className = 'stat-value warning-text';
            }
        }
        
        // Exportar dise√±o
        function exportDesign() {
            const design = {
                mission: missionData,
                areas: areas,
                timestamp: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(design, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `habitat-design-${Date.now()}.json`;
            link.click();
            
            alert('Dise√±o exportado exitosamente!');
        }
        
        // Manejar resize
        function onWindowResize() {
            const container = document.getElementById('canvas-container');
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }
        
        // Loop de animaci√≥n
        function animate() {
            requestAnimationFrame(animate);
            
            // Rotar lentamente el h√°bitat
            habitatGroup.rotation.y += 0.002;
            
            renderer.render(scene, camera);
        }
        
        // Iniciar
        init();
    </script>
</body>
</html>